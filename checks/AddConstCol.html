<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>))
<span class="kw">packageVersion</span>(<span class="st">&quot;dplyr&quot;</span>)</code></pre></div>
<pre><code>## [1] &#39;0.5.0&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">R.Version</span>()$version.string</code></pre></div>
<pre><code>## [1] &quot;R version 3.4.0 (2017-04-21)&quot;</code></pre>
<p>Local <code>data.frame</code> example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dLocal &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span> <span class="dv">1</span>:<span class="dv">2</span>)

f &lt;-<span class="st"> </span>function(dt) {
  <span class="kw">mutate</span>(dt, <span class="dt">newCol=</span> <span class="st">&#39;a&#39;</span>)
}

fCast &lt;-<span class="st"> </span>function(dt) {
  <span class="kw">mutate</span>(dt, <span class="dt">newCol=</span> <span class="kw">as.character</span>(<span class="st">&#39;a&#39;</span>))
}</code></pre></div>
<p>Local <code>data.frame</code> example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>dLocal

<span class="kw">f</span>(d)</code></pre></div>
<pre><code>##   x newCol
## 1 1      a
## 2 2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fCast</span>(d)</code></pre></div>
<pre><code>##   x newCol
## 1 1      a
## 2 2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># clean up</span>
<span class="kw">rm</span>(<span class="dt">list=</span><span class="st">&#39;d&#39;</span>)</code></pre></div>
<p><code>SQLite</code> example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>dplyr::<span class="kw">src_sqlite</span>(<span class="st">&quot;:memory:&quot;</span>, 
                        <span class="dt">create =</span> <span class="ot">TRUE</span>)

d &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, dLocal, <span class="st">&#39;d&#39;</span>)

<span class="kw">f</span>(d)</code></pre></div>
<pre><code>## Source:   query [?? x 2]
## Database: sqlite 3.11.1 [:memory:]
## 
##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fCast</span>(d)</code></pre></div>
<pre><code>## Source:   query [?? x 2]
## Database: sqlite 3.11.1 [:memory:]
## 
##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<p>MySQL example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>dplyr::<span class="kw">src_mysql</span>(<span class="st">&#39;mysql&#39;</span>, 
                       <span class="st">&#39;127.0.0.1&#39;</span>, 
                       <span class="dv">3306</span>, 
                       <span class="st">&#39;root&#39;</span>, <span class="st">&#39;passwd&#39;</span>)

d &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, dLocal, <span class="st">&#39;d&#39;</span>)

<span class="kw">f</span>(d)</code></pre></div>
<pre><code>## Source:   query [?? x 2]
## Database: mysql 5.6.34 [root@127.0.0.1:/mysql]
## 
##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fCast</span>(d)</code></pre></div>
<pre><code>## Source:   query [?? x 2]
## Database: mysql 5.6.34 [root@127.0.0.1:/mysql]

## Error in .local(conn, statement, ...): could not run statement: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;TEXT) AS `newCol`
## FROM `d`) `hrkbkoxnip`
## LIMIT 10&#39; at line 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># clean up</span>
<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&#39;sc&#39;</span>, <span class="st">&#39;d&#39;</span>)); <span class="kw">gc</span>()</code></pre></div>
<pre><code>## Auto-disconnecting mysql connection (0, 0)

##           used (Mb) gc trigger (Mb) max used (Mb)
## Ncells  641712 34.3    1168576 62.5  1168576 62.5
## Vcells 1118054  8.6    2060183 15.8  1659371 12.7</code></pre>
<p>PostgreSQL example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>dplyr::<span class="kw">src_postgres</span>(<span class="dt">host =</span> <span class="st">&#39;localhost&#39;</span>,
                          <span class="dt">port =</span> <span class="dv">5432</span>,
                          <span class="dt">user =</span> <span class="st">&#39;postgres&#39;</span>,
                          <span class="dt">password =</span> <span class="st">&#39;pg&#39;</span>)

d &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, dLocal, <span class="st">&#39;d&#39;</span>)

<span class="kw">f</span>(d)</code></pre></div>
<pre><code>## Source:   query [?? x 2]
## Database: postgres 9.6.1 [postgres@localhost:5432/postgres]

## Warning in postgresqlExecStatement(conn, statement, ...): RS-DBI driver
## warning: (unrecognized PostgreSQL field type unknown (id:705) in column 1)

##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fCast</span>(d)</code></pre></div>
<pre><code>## Source:   query [?? x 2]
## Database: postgres 9.6.1 [postgres@localhost:5432/postgres]
## 
##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># clean up</span>
<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&#39;sc&#39;</span>, <span class="st">&#39;d&#39;</span>)); <span class="kw">gc</span>()</code></pre></div>
<pre><code>## Auto-disconnecting postgres connection (47313, 0)

##           used (Mb) gc trigger (Mb) max used (Mb)
## Ncells  679170 36.3    1168576 62.5  1168576 62.5
## Vcells 1159912  8.9    2060183 15.8  1659371 12.7</code></pre>
<p>Spark 2.1.0 example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>sparklyr::<span class="kw">spark_connect</span>(<span class="dt">version=</span> <span class="st">&#39;2.1.0&#39;</span>, 
                              <span class="dt">master=</span> <span class="st">&quot;local&quot;</span>)

d &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, dLocal, <span class="st">&#39;d&#39;</span>)

<span class="kw">f</span>(d)</code></pre></div>
<pre><code>## Source:   query [2 x 2]
## Database: spark connection master=local[4] app=sparklyr local=TRUE
## 
##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fCast</span>(d)</code></pre></div>
<pre><code>## Source:   query [2 x 2]
## Database: spark connection master=local[4] app=sparklyr local=TRUE
## 
##       x newCol
##   &lt;int&gt;  &lt;chr&gt;
## 1     1      a
## 2     2      a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># clean up</span>
sparklyr::<span class="kw">spark_disconnect</span>(sc)
<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&#39;sc&#39;</span>, <span class="st">&#39;d&#39;</span>)); <span class="kw">gc</span>()</code></pre></div>
<pre><code>##           used (Mb) gc trigger (Mb) max used (Mb)
## Ncells  768182 41.1    1442291 77.1  1442291 77.1
## Vcells 1268761  9.7    2060183 15.8  1734819 13.3</code></pre>
